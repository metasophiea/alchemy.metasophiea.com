(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3363],{9875:function(e,t,i){Promise.resolve().then(i.bind(i,4651))},4403:function(e,t){"use strict";t.Z={imageUrl:"",pageName:"how-to-make-a-unit/3",previousPageName:"how-to-make-a-unit/2",title:"How To Make A Unit - Part 3",subTitle:"Light And Switch - Undo / Redo"}},4651:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return h}});var n=i(7437),a=i(7648),s=i(904),o=i(459),r=i(4443),c=i(4403),l=i(8870),d=i.n(l);function h(){return(0,n.jsx)("main",{children:(0,n.jsxs)(s.Z,{contentSummary:c.Z,children:[(0,n.jsx)(r.Z,{children:(0,n.jsx)("p",{children:"This article is part of a series. If you haven't completed part one or two, we recommend you do so before continuing with this one."})}),(0,n.jsx)("p",{children:"We're going to use the unit you created in the previous chapter and modify it to have Undo / Redo functionality."}),(0,n.jsx)("h2",{children:"How Does Undo / Redo Work"}),(0,n.jsx)("p",{children:"One action a user might perform is an attempt to undo or redo an action. Similar to the Import / Export section described in the previous chapter, much of this process is handled by Alchemy, but aspects related to the configuration of a unit is left to the designer of that unit."}),(0,n.jsxs)("p",{children:['In order to not have to save the entire configuration for every single action, a "Modification" concept is used instead. The idea is that if a designer wishes that a certain action be "undoable", then the performance of that action should return a ',(0,n.jsx)(a.default,{className:d().link,href:"/guide/developer/reference/viewer?referenceFile=Platform/unit/unit/modification/mod.intermediateFormat.json",children:'"modification" object'}),", which contains information on what aspect of the configuration was changed and what the before and after of that aspect was."]}),(0,n.jsx)("p",{children:"Similar to Export/Import, Alchemy only stipulates that the data stored in a Modification object is a string, meaning that any format can be used so long as it is representable in string form. The collection and encoding of this data is the responsibility of the unit's designer, as is the correct decoding and distribution of this data when an Undo or Redo event occurs."}),(0,n.jsx)("p",{children:'This "modification" is stored and managed by Alchemy. When a user activates the "undo" function, Alchemy runs the "undo" method of the unit, providing the "modification" object. If the user activates the "redo" function, Alchemy runs the "redo" method of the unit and provides the "modification" object.'}),(0,n.jsx)("p",{children:'If a unit has not returned a modification for an action by the time a user attempts to "undo" or "redo" it; then the next modification in the undo/redo timeline is used instead, voiding the unit\'s opportunity to provide a modification for this action.'}),(0,n.jsx)("h2",{children:"Let's Do It"}),(0,n.jsx)("p",{children:"All you have to do is modify the main.ts file to look like this"}),(0,n.jsx)(o.default,{lines:[{text:'import apiConsole from "../typescript-deno-0.3.3-0.1.0/index.ts";',intensity:o.a.Dim},{text:"",intensity:o.a.Dim},{text:"let state = false;",intensity:o.a.Dim},{text:"",intensity:o.a.Dim},{text:"function updateExportableData() {",intensity:o.a.Dim},{text:"	apiConsole.unit.updateExportableData(",intensity:o.a.Dim},{text:"		JSON.stringify(state)",intensity:o.a.Dim},{text:"	);",intensity:o.a.Dim},{text:"}",intensity:o.a.Dim},{text:"",intensity:o.a.Dim},{text:"apiConsole.unit.setImportListener(({dataString}) => {",intensity:o.a.Dim},{text:"	state = JSON.parse(dataString) as boolean;",intensity:o.a.Dim},{text:"	apiConsole.interface.glowbox.onOff(0, true,  state);",intensity:o.a.Dim},{text:"	if(state) {",intensity:o.a.Dim},{text:"		apiConsole.interface.checkbox.check(1, true);",intensity:o.a.Dim},{text:"	} else {",intensity:o.a.Dim},{text:"		apiConsole.interface.checkbox.uncheck(1, true);",intensity:o.a.Dim},{text:"	}",intensity:o.a.Dim},{text:"});",intensity:o.a.Dim},{text:"",intensity:o.a.Dim},{text:"apiConsole.unit.setMouseEventListener(({ event }) => {",intensity:o.a.Dim},{text:'	if(event.type === "checkbox") {',intensity:o.a.Dim},{text:'		state = event.content === "checked";',intensity:o.a.Dim},{text:"		apiConsole.interface.glowbox.onOff(0, true,  state);",intensity:o.a.Dim},{text:"		updateExportableData();",intensity:o.a.Dim},{text:"",intensity:o.a.Dim},{text:"		return apiConsole.createModification("},{text:'			"light",'},{text:"			JSON.stringify(!state),"},{text:"			JSON.stringify(state)"},{text:"		);"},{text:"	}",intensity:o.a.Dim},{text:"});",intensity:o.a.Dim},{text:"",intensity:o.a.Dim},{text:"apiConsole.unit.setUndoListener(({ modification }) => {"},{text:"	if(modification.meta === 'light') {"},{text:"		let state = JSON.parse(modification.before);"},{text:""},{text:"		apiConsole.interface.glowbox.onOff(0, true, state);"},{text:""},{text:"		if(state) {"},{text:"			apiConsole.interface.checkbox.check(1, true);"},{text:"		} else {"},{text:"			apiConsole.interface.checkbox.uncheck(1, true);"},{text:"		}"},{text:"	}"},{text:"});"},{text:""},{text:"apiConsole.unit.setRedoListener(({ modification }) => {"},{text:"	if(modification.meta === 'light') {"},{text:"		let state = JSON.parse(modification.after);"},{text:""},{text:"		apiConsole.interface.glowbox.onOff(0, true, state);"},{text:""},{text:"		if(state) {"},{text:"			apiConsole.interface.checkbox.check(1, true);"},{text:"		} else {"},{text:"			apiConsole.interface.checkbox.uncheck(1, true);"},{text:"		}"},{text:"	}"},{text:"});"}],includeLineNumbers:!0}),(0,n.jsx)("p",{children:"Lets step through the changes and additions made here"}),(0,n.jsxs)("div",{className:d().group,children:[(0,n.jsx)("p",{children:"Our modifications come in three parts"}),(0,n.jsxs)("ol",{children:[(0,n.jsx)("li",{children:"setting up the unit to send Modifications"}),(0,n.jsx)("li",{children:"dealing with Undo events"}),(0,n.jsx)("li",{children:"dealing with Redo events"})]}),(0,n.jsx)("p",{children:"Lets start with sending Modifications first"}),(0,n.jsx)("p",{children:'We must send a Modification on ever successful change of the light, so at the sample place where we added the "updateExportableData" command, we also return the Modification. The "setMouseEventListener" listener is already set up to handle the channelling of Modifications, so all we have to do is return the Modification in the callback function.'}),(0,n.jsx)("p",{children:'Lines 26 to 30 cover this. The Typescript-Deno API console comes with a handy "createModification" command to which we send three important pieces of information; the modification type, the before state and the after state. In this case we define this modification as a change to the "light", with the "before" state just being whatever the opposite of the current "state" value is. The "after" state is the current value.'}),(0,n.jsx)("p",{children:"Now for the listeners"}),(0,n.jsx)("p",{children:'Much like the "setImportListener" command, we use a pair of listeners to handle undo and redo events; "setUndoListener" and "setRedoListener". Both take a callback function which will be run when the corresponding event occurs, being supplied with the Modification.'}),(0,n.jsx)("p",{children:"The Undo handler can be seen starting on line 34, and the Redo lister can be seen starting on line 48. Both function in the same way; first checking for the modification type then updating the state, after which the Parts are refreshed to match the new state."}),(0,n.jsx)("p",{children:'Note how the "before" state is used in the Undo handler, and the "after" state is used in the Redo handler.'})]}),(0,n.jsx)("h2",{children:"Done!"}),(0,n.jsx)("p",{children:"Congratulations! You now have yourself a custom made, externally controlled unit with import/export and undo/redo functionality."}),(0,n.jsx)("p",{children:"This concludes the Getting Started Tutorials. We hope you found it useful!"}),(0,n.jsxs)("p",{children:["You should now have a good grasp on the basics of creating a unit for use in Alchemy. There is of course much more you can do; check out some of the ",(0,n.jsx)(a.default,{className:d().link,href:"/guide/developer/tutorials",children:"other tutorials"})," for more, and don't forget the ",(0,n.jsx)(a.default,{className:d().link,href:"/guide/developer/reference",children:"reference section"})," which covers all the messages and data structures which can be sent from or received by Alchemy."]}),(0,n.jsx)("p",{children:"Happy Coding!"})]})})}},904:function(e,t,i){"use strict";i.d(t,{Z:function(){return l}});var n=i(7437),a=i(1994),s=i(7648),o=i(5027),r=i(7829),c=i.n(r);function l(e){let t=e.contentSummary.imageUrl?e.contentSummary.imageUrl:"/four_colour_stripes_banner.png";return(0,n.jsxs)("div",{className:c().main,children:[(0,n.jsx)(o.Z,{className:c().breadcrumbs,list:[{name:"home",url:"/"},{name:"guide",url:"/guide"},{name:"developer",url:"/guide/developer"},{name:"tutorials",url:"/guide/developer/tutorials"},{name:e.contentSummary.title,url:"/guide/developer/tutorials/article/"+e.contentSummary.pageName}]}),(0,n.jsxs)("div",{className:c().content,children:[(0,n.jsx)("h1",{className:c().title,children:e.contentSummary.title}),e.contentSummary.subTitle&&(0,n.jsx)("h2",{className:c().subTitle,children:e.contentSummary.subTitle}),(0,n.jsx)("img",{src:t,className:c().headerImage}),(0,n.jsx)("div",{className:c().childrenWrapper,children:e.children}),(0,n.jsxs)("div",{className:c().previousNext,children:[e.contentSummary.previousPageName&&(0,n.jsx)(s.default,{href:"/guide/developer/tutorials/article/"+e.contentSummary.previousPageName,className:(0,a.Z)(c().nextPreviousButton,c().previousPage),children:"Previous"}),e.contentSummary.nextPageName&&(0,n.jsx)(s.default,{href:"/guide/developer/tutorials/article/"+e.contentSummary.nextPageName,className:(0,a.Z)(c().nextPreviousButton,c().nextPage),children:"Next"})]})]})]})}},459:function(e,t,i){"use strict";i.d(t,{a:function(){return a},default:function(){return d}});var n,a,s=i(7437),o=i(1994),r=i(2265),c=i(6062),l=i.n(c);function d(e){let[t,i]=(0,r.useState)(!1);return(0,s.jsxs)("div",{className:l().main,children:[(0,s.jsxs)("div",{className:(0,o.Z)(l().codeSpace,{[l().codeSpace_limited]:!t}),children:[e.includeLineNumbers&&(0,s.jsx)("div",{className:l().lineNumbers,children:e.lines.map((e,t)=>(0,s.jsx)("pre",{className:l().line,children:t},t))}),(0,s.jsx)("div",{className:l().lines,children:e.lines.map((e,t)=>"string"==typeof e?(0,s.jsx)("pre",{className:l().line,children:""===e?" ":e},t):(0,s.jsx)("pre",{className:(0,o.Z)(l().line,{[l().bright]:void 0!==e.intensity&&1===e.intensity,[l().dim]:void 0!==e.intensity&&0===e.intensity}),children:""===e.text?" ":e.text},t))})]}),e.lines.length>30&&(0,s.jsx)("div",{className:l().showMore,children:(0,s.jsx)("p",{onClick:function(){i(!t)},children:t?"Show Less":"Show More"})})]})}(n=a||(a={}))[n.Dim=0]="Dim",n[n.Bright=1]="Bright",n[n.Normal=2]="Normal"},4443:function(e,t,i){"use strict";i.d(t,{Z:function(){return r}});var n=i(7437),a=i(1994),s=i(1463),o=i.n(s);function r(e){return(0,n.jsxs)("div",{className:(0,a.Z)(o().main,{[e.className||""]:void 0!==e.className}),children:[(0,n.jsx)("h3",{className:o().title,children:"Note"}),(0,n.jsx)("div",{className:o().children,children:e.children})]})}},5027:function(e,t,i){"use strict";i.d(t,{Z:function(){return c}});var n=i(7437),a=i(1994),s=i(7648),o=i(2314),r=i.n(o);function c(e){let t=e.list.map((t,i)=>{let a=i==e.list.length-1;return(0,n.jsx)(s.default,{href:t.url,className:r().link,"aria-disabled":a,tabIndex:a?-1:void 0,children:t.name},i)});return(0,n.jsx)("div",{className:(0,a.Z)(r().main,{[e.className||""]:void 0!==e.className}),children:t.map((e,t)=>[(0,n.jsx)("p",{className:r().divider,children:"/"},"divider"+t),e]).flat().slice(1)})}},7648:function(e,t,i){"use strict";i.d(t,{default:function(){return a.a}});var n=i(2972),a=i.n(n)},8870:function(e){e.exports={unorderedList:"style_unorderedList__CcAA9",image:"style_image__0ycHi",image80:"style_image80__ax_CV",smallImageWrapper:"style_smallImageWrapper__LfaAn",smallImage:"style_smallImage__RJAt_",group:"style_group__F7vT_"}},7829:function(e){e.exports={main:"style_main__c51pI",content:"style_content__rQ3D1",link:"style_link__TrkdQ",title:"style_title__QJpJn",subTitle:"style_subTitle___R0E7",headerImage:"style_headerImage__jM6kU",childrenWrapper:"style_childrenWrapper__Nt54u",previousNext:"style_previousNext__Pea0Y",nextPreviousButton:"style_nextPreviousButton__BDi40",previousPage:"style_previousPage__i2BI3",nextPage:"style_nextPage__eSJ7i"}},6062:function(e){e.exports={main:"style_main__GW_QM",codeSpace:"style_codeSpace__m5Tgk",codeSpace_limited:"style_codeSpace_limited__cJzT_",showMore:"style_showMore__8WfBB",lineNumbers:"style_lineNumbers__S0NBN",lines:"style_lines__PGiOP",line:"style_line__dmLdn",dim:"style_dim__3BD2K",bright:"style_bright__qvLwq"}},1463:function(e){e.exports={main:"style_main__L8yyS",title:"style_title__oTWxy",children:"style_children__6YSiK"}},2314:function(e){e.exports={main:"style_main__F_177",divider:"style_divider__YWHjs",link:"style_link__eozNW"}},1994:function(e,t,i){"use strict";t.Z=function(){for(var e,t,i=0,n="",a=arguments.length;i<a;i++)(e=arguments[i])&&(t=function e(t){var i,n,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t){if(Array.isArray(t)){var s=t.length;for(i=0;i<s;i++)t[i]&&(n=e(t[i]))&&(a&&(a+=" "),a+=n)}else for(n in t)t[n]&&(a&&(a+=" "),a+=n)}return a}(e))&&(n&&(n+=" "),n+=t);return n}}},function(e){e.O(0,[6322,2972,2971,2117,1744],function(){return e(e.s=9875)}),_N_E=e.O()}]);